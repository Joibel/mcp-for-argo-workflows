services:
  mcp-for-argo-workflows:
    # For production, pin to a specific version instead of :latest
    # image: ghcr.io/joibel/mcp-for-argo-workflows:v1.0.0
    image: ghcr.io/joibel/mcp-for-argo-workflows:latest
    container_name: mcp-for-argo-workflows
    ports:
      - "8080:8080"
    environment:
      - MCP_TRANSPORT=http
      - MCP_HTTP_ADDR=:8080
      - ARGO_NAMESPACE=${ARGO_NAMESPACE:-argo}
      # For Argo Server connection (optional)
      - ARGO_SERVER=${ARGO_SERVER:-}
      - ARGO_TOKEN=${ARGO_TOKEN:-}
      - ARGO_SECURE=${ARGO_SECURE:-true}
      - ARGO_INSECURE_SKIP_VERIFY=${ARGO_INSECURE_SKIP_VERIFY:-false}
    volumes:
      # Mount kubeconfig for direct Kubernetes API access
      - ./kubeconfig:/root/.kube/config:ro
    restart: unless-stopped
    # Note: Healthcheck disabled because the distroless image does not include wget/curl.
    # The application exposes /health endpoint for external health checks.

  # Alternative: Connect to host network (for accessing localhost services)
  # This profile is intended for local development with port-forwarded Argo Server.
  mcp-for-argo-workflows-host:
    # For production, pin to a specific version instead of :latest
    # image: ghcr.io/joibel/mcp-for-argo-workflows:v1.0.0
    image: ghcr.io/joibel/mcp-for-argo-workflows:latest
    container_name: mcp-for-argo-workflows-host
    profiles:
      - host-network
    network_mode: host
    environment:
      - MCP_TRANSPORT=http
      - MCP_HTTP_ADDR=:8080
      - ARGO_NAMESPACE=${ARGO_NAMESPACE:-argo}
      - ARGO_SERVER=${ARGO_SERVER:-localhost:2746}
      - ARGO_TOKEN=${ARGO_TOKEN:-}
      # TLS verification disabled by default for local development with port-forwarding
      - ARGO_INSECURE_SKIP_VERIFY=${ARGO_INSECURE_SKIP_VERIFY:-true}
    volumes:
      - ./kubeconfig:/root/.kube/config:ro
    restart: unless-stopped
